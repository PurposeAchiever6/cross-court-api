module Api
  module V1
    class PromoCodesController < Api::V1::ApiController
      def show
        new_price = promo_code.present? ? promo_code.apply_discount(price) : price
        render json: { price: new_price }, status: :ok
      end

      private

      def price
        @price ||= params[:price]
      end

      def promo_code
        @promo_code ||= PromoCode.find_by(code: params[:promo_code])
        return @promo_code if @promo_code.present/

        raise ActiveRecord::RecordNotFound, I18n.t('api.errors.promo_code.invalid')
      end
    end
  end
end
